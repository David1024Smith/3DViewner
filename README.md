# 3DViewner

一个基于Qt3D的3D查看器应用程序，可以加载和显示3D模型。

## 功能特性

- 加载和显示3D模型
- 相机控制
  - 鼠标滚轮缩放
  - 中键拖动平移
  - Alt+中键旋转
  - 视图切换：T(顶视图)、F(前视图)、L(左视图)、P(透视图)
- 点光源
- WASD键控制模型旋转
- 单例模式的日志系统

## 构建说明

1. 确保已安装Visual Studio 2019 
2. 确保已安装Qt 6.5.3 MinGW 64-bit
**使用的技术栈**：
- C++17
- Qt 6.5.3
- CMake

## 日志系统

应用程序使用单例模式实现的日志系统，具有以下特点：

- 支持多种日志级别（Debug, Info, Warning, Critical, Fatal）
- 自动捕获Qt调试输出（qDebug, qInfo等）
- 日志输出到控制台和文件
- 线程安全
- 时间戳和日志级别标记

## 相机控制

应用程序提供了类似3ds Max的相机控制功能：

- **视图切换**：使用快捷键T、F、L、P分别切换到顶视图、前视图、左视图和透视图
- **视图导航**：
  - 鼠标中键滚动：缩放视图
  - 中键拖动：平移视图
  - Alt+中键拖动：旋转视图

## 开发日志

### 2023-06-02 使用QOrbitCameraController改进相机控制
**会话主要目的**：参考Qt3DDemo源码，使用Qt3D内置的QOrbitCameraController替代手动实现的鼠标控制，解决模型显示不完整和控制不够流畅的问题

**完成的主要任务**：
- 引入Qt3DExtras::QOrbitCameraController替代手动鼠标事件处理
- 移除自定义的鼠标事件处理代码（wheelEvent、mousePressEvent、mouseMoveEvent等）
- 移除自定义的相机控制方法（zoomCamera、panCamera、rotateCamera）
- 保留键盘快捷键功能（T/F/L/P视图切换、Home键适应视图）
- 简化代码结构，提高稳定性

**关键决策和解决方案**：
- 使用Qt3D内置的QOrbitCameraController，提供标准的3D相机控制体验
- QOrbitCameraController自动处理鼠标左键拖动（轨道旋转）、右键拖动（平移）、滚轮缩放
- 保留自定义的键盘快捷键和视图切换功能
- 保留fitToView自动适应视图功能
- 移除Alt键相关的复杂逻辑，简化事件处理

**使用的技术栈**：
- C++17
- Qt 6.5.3 MinGW 64-bit
- Qt3DExtras::QOrbitCameraController
- CMake

**修改的文件**：
- Qt3DView.cpp：添加QOrbitCameraController，移除手动鼠标事件处理
- Qt3DView.h：添加QOrbitCameraController声明，移除鼠标事件处理方法
- AppWindow.cpp：简化键盘事件处理，移除Alt键处理
- README.md：更新开发日志

**新的相机控制方式**：
- **鼠标左键拖动**：轨道旋转（围绕目标点旋转相机）
- **鼠标右键拖动**：平移视图
- **鼠标滚轮**：缩放视图
- **键盘快捷键**：
  - T键：切换到顶视图
  - F键：切换到前视图
  - L键：切换到左视图
  - P键：切换到透视视图
  - Home键：适应视图使模型完全可见

**优势**：
- 更稳定和成熟的相机控制体验
- 符合标准3D软件的操作习惯
- 减少了大量自定义代码，提高了可维护性
- 自动处理边界限制和平滑动画
- 更好的性能和响应速度

**参考源码**：基于Qt3DDemo项目的实现方式，使用Qt3D内置组件替代自定义实现

### 2023-06-01 修复模型显示和缩放问题
**会话主要目的**：解决模型加载时显示过大、无法完整显示和缩放功能不正常的问题

**完成的主要任务**：
- 实现自动适应视图功能，根据模型大小自动调整相机位置
- 添加模型边界框计算功能
- 改进鼠标滚轮缩放算法，使其更加平滑和直观
- 在模型加载后自动调用fitToView功能
- 添加Home键快捷键来手动触发适应视图功能

**关键决策和解决方案**：
- 实现fitToView()方法，自动计算模型边界并调整相机位置
- 使用递归算法遍历场景中的所有实体来计算边界框
- 改进zoomCamera()方法，使缩放速度根据当前距离动态调整
- 在模型加载完成后延迟100ms自动调用fitToView，确保模型完全加载
- 添加Home键作为手动适应视图的快捷键

**使用的技术栈**：
- C++17
- Qt 6.5.3 MinGW 64-bit
- Qt3D几何计算和变换
- CMake

**修改的文件**：
- Qt3DView.cpp：添加fitToView、边界计算和改进缩放功能
- Qt3DView.h：添加新方法声明和ViewState结构体
- AppWindow.cpp：添加模型加载后自动适应视图功能，添加QTimer头文件
- README.md：更新开发日志

**新增功能**：
- 自动适应视图：模型加载后自动调整相机位置使模型完全可见
- Home键快捷键：手动触发适应视图功能
- 改进的缩放算法：根据当前距离动态调整缩放速度，更加平滑直观
- 模型边界框计算：递归计算场景中所有几何体的边界框

**使用说明**：
- 加载模型后会自动适应视图
- 按Home键可以随时重新适应视图
- 鼠标滚轮缩放现在更加平滑和直观
- 支持的相机控制功能包括：
  - 鼠标滚轮：缩放视图
  - 中键拖动：平移视图  
  - Alt+中键拖动：旋转视图
  - T/F/L/P键：切换到顶/前/左/透视视图
  - Home键：适应视图使模型完全可见

### 2023-05-31 修复相机控制功能
**会话主要目的**：修复相机控制功能无法正常工作的问题，确保T/F/L/P视图切换和鼠标控制功能正常

**完成的主要任务**：
- 重构Qt3DView的事件处理机制，移除事件过滤器
- 直接重写鼠标和键盘事件处理函数
- 改进AppWindow中的键盘事件传递机制
- 添加调试输出验证事件接收
- 设置正确的焦点策略

**关键决策和解决方案**：
- 移除eventFilter机制，直接在Qt3DView中重写事件处理函数
- 设置StrongFocus焦点策略确保能接收键盘事件
- 在AppWindow中改进键盘事件的转发机制
- 添加详细的调试输出来验证事件处理流程

**使用的技术栈**：
- C++17
- Qt 6.5.3 MinGW 64-bit
- Qt3D事件系统
- CMake

**修改的文件**：
- Qt3DView.cpp：重构事件处理机制，添加调试输出
- Qt3DView.h：移除eventFilter声明
- AppWindow.cpp：改进键盘事件传递，添加焦点设置
- README.md：更新开发日志

### 2023-05-28 升级到Qt 6.5.3
**会话主要目的**：将项目从Qt 5.15.2升级到Qt 6.5.3 MinGW 64-bit

**完成的主要任务**：
- 修复Qt3DView.h中缺少QVector3D头文件的问题
- 更新CMakeLists.txt以支持Qt6
- 更新头文件包含路径以适应Qt6的命名空间变化
- 提升C++标准到C++17（Qt6推荐）

**关键决策和解决方案**：
- 添加缺少的头文件包含
- 更新Qt库的命名空间路径
- 更新CMakeLists.txt中的Qt依赖项

**使用的技术栈**：
- C++17
- Qt 6.5.3
- CMake

**修改的文件**：
- Qt3DView.h：添加QVector3D头文件
- Qt3DView.cpp：更新头文件包含路径
- CMakeLists.txt：更新Qt依赖项和C++标准
- AppWindow.cpp：移除不必要的头文件
- README.md：更新Qt版本信息

### 2023-05-29 修复Qt6兼容性问题
**会话主要目的**：修复代码编译错误，使项目能在Qt 6.5.3 MinGW 64-bit环境下编译

**完成的主要任务**：
- 修复Qt3DView.h中缺少QVector3D头文件导致的编译错误
- 更新CMakeLists.txt，将Qt5依赖更新为Qt6
- 更新头文件包含路径以适应Qt6的命名空间变化
- 提升C++标准到C++17以适应Qt6

**关键决策和解决方案**：
- 添加缺少的头文件包含解决大部分编译错误
- 更新Qt库的命名空间路径，使用更明确的包含方式
- 移除不必要的头文件，减少潜在的冲突

**使用的技术栈**：
- C++17
- Qt 6.5.3 MinGW 64-bit
- CMake

**修改的文件**：
- Qt3DView.h：添加QVector3D头文件
- Qt3DView.cpp：更新头文件包含路径
- CMakeLists.txt：更新Qt依赖项和C++标准
- AppWindow.cpp：移除不必要的头文件
- README.md：更新Qt版本信息

### 2023-05-30 修复QForwardRenderer路径问题
**会话主要目的**：解决Qt6中QForwardRenderer头文件路径变更导致的编译错误

**完成的主要任务**：
- 修复Qt3DView.cpp中QForwardRenderer头文件包含路径
- 将Qt3DRender/QForwardRenderer更新为Qt3DExtras/QForwardRenderer

**关键决策和解决方案**：
- 在Qt6中，QForwardRenderer类已从Qt3DRender命名空间移至Qt3DExtras命名空间
- 更新头文件包含路径以适应Qt6的命名空间变化

**使用的技术栈**：
- C++17
- Qt 6.5.3 MinGW 64-bit
- CMake

**修改的文件**：
- Qt3DView.cpp：更新QForwardRenderer的头文件包含路径
- README.md：更新开发日志

### 2023-05-25 日志系统重构
移除界面log窗口，保留程序调试信息输出，重构代码日志为单例模式

- 采用单例设计模式实现Logger类
- 使用QMutex确保线程安全
- 支持多种日志级别和格式化输出
- 与Qt调试系统(qDebug等)集成

### 2023-05-26 相机控制功能增强
实现鼠标滚轮控制相机远近和视图切换功能，参考3ds Max软件的操作方式

- 添加鼠标滚轮缩放功能
- 实现中键拖动平移视图
- 实现Alt+中键旋转视图
- 添加T、F、L、P快捷键切换视图
- 支持正交投影和透视投影

### 2023-05-27 相机控制系统实现
**会话主要目的**：实现鼠标滚轮控制相机远近和视图切换功能，参考3ds Max软件的操作方式

**完成的主要任务**：
- 扩展Qt3DView类，添加事件处理和视图切换功能
- 实现鼠标滚轮缩放、中键平移和Alt+中键旋转功能
- 添加T、F、L、P快捷键视图切换功能
- 实现视图状态保存和恢复功能
- 实现正交投影和透视投影切换

**关键决策和解决方案**：
- 使用事件过滤器捕获鼠标和键盘事件
- 实现视图状态管理，保存和恢复不同视图的相机位置和方向
- 使用QCamera的投影矩阵切换正交投影和透视投影
- 通过事件传递确保键盘事件能够正确处理

**使用的技术栈**：
- Qt3D相机控制
- Qt事件系统
- 3D数学（向量、四元数等）

**修改的文件**：
- Qt3DView.h：添加事件处理和视图切换功能
- Qt3DView.cpp：实现鼠标控制和视图切换功能
- AppWindow.h：添加键盘事件处理
- AppWindow.cpp：实现键盘事件传递
- README.md：更新功能说明和开发日志
